<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>倒数日 - 添加新倒数日</title>
    <link rel="stylesheet" href="tailwind.min.css">
    <link rel="stylesheet" href="icons.css">
    <link rel="stylesheet" href="festival.css">
    <link rel="stylesheet" href="glass-morphism.css">
    <style>
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f8f9fa;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }
        .mockup-frame {
            border: 2px dashed #e2e8f0;
            border-radius: 2rem;
            padding: 1rem;
            margin: 1rem;
            width: 360px;
            height: 720px;
            overflow: hidden;
            position: relative;
        }
        .input-field {
            transition: all 0.3s ease;
        }
        .input-field:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        .category-chip {
            transition: all 0.2s ease;
        }
        .category-chip:hover {
            transform: scale(1.05);
        }
        .category-chip.active {
            background-color: #6366f1;
            color: white;
            border-color: #6366f1;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50">
    <div class="container mx-auto p-4 flex flex-wrap justify-center">
        <!-- 添加新倒数日页面 -->
        <div class="mockup-frame bg-gray-50">
            <div class="h-full flex flex-col">
                <!-- 顶部导航栏 -->
                <div class="glass-effect rounded-xl p-4 flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <button class="p-2 mr-2 rounded-full bg-indigo-100 text-indigo-600 hover:bg-indigo-200" onclick="window.location.href='index.html'">
                            <img src="./icons/arrow-left.svg" class="w-5 h-5 icon-with-fallback" alt="返回">
                        </button>
                        <h1 class="text-xl font-bold text-indigo-900">添加新倒数日</h1>
                    </div>
                    <button class="px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition-colors">
                        保存
                    </button>
                </div>
                
                <!-- 表单内容 -->
                <div class="flex-1 overflow-y-auto space-y-6 p-2">
                    <!-- 标题输入 -->
                    <div class="glass-effect rounded-xl p-4">
                        <label for="title" class="block text-sm font-medium text-gray-700 mb-2">标题</label>
                        <input type="text" id="title" placeholder="例如：毕业典礼、生日、旅行..." 
                               class="input-field w-full px-4 py-3 bg-white bg-opacity-70 border border-gray-200 rounded-xl focus:outline-none">
                    </div>
                    
                    <!-- 日期选择 -->
                    <div class="glass-effect rounded-xl p-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">日期</label>
                        <div class="relative">
                            <input type="date" class="input-field w-full px-4 py-3 bg-white bg-opacity-70 border border-gray-200 rounded-xl focus:outline-none">
                            <div class="absolute right-4 top-3 pointer-events-none">
                                <img src="./icons/calendar.svg" class="w-5 h-5 text-gray-500 icon-with-fallback" alt="日历">
                            </div>
                        </div>
                    </div>
                    
                    <!-- 分类选择 -->
                    <div class="glass-effect rounded-xl p-4">
                        <label class="block text-sm font-medium text-gray-700 mb-3">分类</label>
                        <div class="flex flex-wrap gap-2" id="category-container">
                            <button class="category-chip px-4 py-2 rounded-full bg-white border border-gray-200 text-gray-700 font-medium text-sm whitespace-nowrap hover:border-indigo-300">
                                学习
                            </button>
                            <button class="category-chip px-4 py-2 rounded-full bg-white border border-gray-200 text-gray-700 font-medium text-sm whitespace-nowrap hover:border-indigo-300">
                                工作
                            </button>
                            <button class="category-chip px-4 py-2 rounded-full bg-white border border-gray-200 text-gray-700 font-medium text-sm whitespace-nowrap hover:border-indigo-300">
                                生活
                            </button>
                            <button class="category-chip px-4 py-2 rounded-full bg-white border border-gray-200 text-gray-700 font-medium text-sm whitespace-nowrap hover:border-indigo-300">
                                节日
                            </button>
                            <button class="category-chip px-4 py-2 rounded-full bg-white border border-gray-200 text-gray-700 font-medium text-sm whitespace-nowrap hover:border-indigo-300">
                                自定义1
                            </button>
                            <button class="category-chip px-4 py-2 rounded-full bg-white border border-gray-200 text-gray-700 font-medium text-sm whitespace-nowrap hover:border-indigo-300">
                                自定义2
                            </button>
                            <button class="category-chip px-4 py-2 rounded-full bg-white border border-gray-200 text-gray-700 font-medium text-sm whitespace-nowrap hover:border-indigo-300">
                                自定义3
                            </button>
                            <button class="category-chip px-4 py-2 rounded-full bg-white border border-gray-200 text-gray-700 font-medium text-sm whitespace-nowrap hover:border-indigo-300">
                                自定义4
                            </button>
                        </div>
                    </div>
                    
                    <!-- 颜色选择 -->
                    <div class="glass-effect rounded-xl p-4">
                        <label class="block text-sm font-medium text-gray-700 mb-3">颜色</label>
                        <div class="flex space-x-3" id="color-container">
                            <button class="w-8 h-8 rounded-full bg-indigo-500" data-color="indigo-500"></button>
                            <button class="w-8 h-8 rounded-full bg-pink-500" data-color="pink-500"></button>
                            <button class="w-8 h-8 rounded-full bg-purple-500" data-color="purple-500"></button>
                            <button class="w-8 h-8 rounded-full bg-blue-500" data-color="blue-500"></button>
                            <button class="w-8 h-8 rounded-full bg-green-500" data-color="green-500"></button>
                            <button class="w-8 h-8 rounded-full bg-yellow-500" data-color="yellow-500"></button>
                            <button class="w-8 h-8 rounded-full bg-red-500" data-color="red-500"></button>
                            <button class="w-8 h-8 rounded-full bg-gray-500" data-color="gray-500"></button>
                        </div>
                    </div>
                    
                    <!-- 备注 -->
                    <div class="glass-effect rounded-xl p-4">
                        <label for="notes" class="block text-sm font-medium text-gray-700 mb-2">备注（可选）</label>
                        <textarea id="notes" rows="3" placeholder="添加一些备注..." 
                                  class="input-field w-full px-4 py-3 bg-white bg-opacity-70 border border-gray-200 rounded-xl focus:outline-none resize-none"></textarea>
                    </div>
                    
                    <!-- 提醒设置 -->
                    <div class="glass-effect rounded-xl p-4">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <img src="./icons/bell.svg" class="w-5 h-5 mr-2 text-gray-700 icon-with-fallback" alt="提醒">
                                <span class="text-sm font-medium text-gray-700">开启提醒</span>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" value="" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- 底部导航栏 -->
                <div class="glass-effect rounded-xl p-3 mt-4 flex justify-around items-center">
                    <button class="flex flex-col items-center p-2 text-gray-500 hover:text-indigo-600">
                        <img src="./icons/home.svg" class="w-6 h-6 icon-with-fallback" alt="首页">
                        <span class="text-xs mt-1">首页</span>
                    </button>
                    <button class="flex flex-col items-center p-2 text-gray-500 hover:text-indigo-600">
                        <img src="./icons/calendar.svg" class="w-6 h-6 icon-with-fallback" alt="日历">
                        <span class="text-xs mt-1">日历</span>
                    </button>
                    <div class="relative -mt-8">
                        <button class="w-14 h-14 rounded-full bg-gradient-to-r from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg">
                            <img src="./icons/plus.svg" class="w-8 h-8 text-white icon-with-fallback" alt="添加">
                        </button>
                    </div>
                    <button class="flex flex-col items-center p-2 text-gray-500 hover:text-indigo-600">
                        <img src="./icons/bell.svg" class="w-6 h-6 icon-with-fallback" alt="提醒">
                        <span class="text-xs mt-1">提醒</span>
                    </button>
                    <button class="flex flex-col items-center p-2 text-gray-500 hover:text-indigo-600">
                        <img src="./icons/user.svg" class="w-6 h-6 icon-with-fallback" alt="我的">
                        <span class="text-xs mt-1">我的</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
<script src="languages.js"></script>
<script src="language-switcher.js"></script>
<script src="icon-fallback.js"></script>
<script src="navigation.js"></script>
<script src="countdown-storage.js"></script>
<script src="category-colors.js"></script>
<script src="debug.js"></script>
<script>
    // 初始化分类选择功能
    function initCategorySelection() {
        const categoryChips = document.querySelectorAll('.category-chip');
        console.log(`找到${categoryChips.length}个分类选项`);
        
        categoryChips.forEach(chip => {
            chip.addEventListener('click', function() {
                // 移除所有分类的active类
                categoryChips.forEach(c => {
                    c.classList.remove('active');
                    c.classList.remove('bg-indigo-600', 'text-white');
                    if (!c.classList.contains('bg-white')) {
                        c.classList.add('bg-white', 'border', 'border-gray-200', 'text-gray-700');
                    }
                });
                
                // 为当前点击的分类添加active类
                this.classList.add('active');
                this.classList.remove('bg-white', 'border', 'border-gray-200', 'text-gray-700');
                this.classList.add('bg-indigo-600', 'text-white');
                
                // 获取选中的分类名称
                const categoryName = this.textContent.trim();
                console.log(`选择了分类: ${categoryName}`);
                
                // 根据分类自动选择对应的固定颜色
                updateSelectedColorByCategory(categoryName);
            });
        });
    }
    
    // 根据分类更新选中的颜色
    function updateSelectedColorByCategory(categoryName) {
        // 获取该分类对应的固定颜色
        const categoryColor = getCategoryColor(categoryName);
        console.log(`分类"${categoryName}"对应的固定颜色: ${categoryColor}`);
        
        // 找到对应的颜色按钮并选中它
        const colorButtons = document.querySelectorAll('#color-container .rounded-full');
        
        // 先移除所有颜色按钮的选中状态
        colorButtons.forEach(button => {
            button.classList.remove('ring-2', 'ring-offset-2');
            // 移除所有ring-{color}类
            for (let i = 0; i < button.classList.length; i++) {
                if (button.classList[i].startsWith('ring-') && 
                    button.classList[i] !== 'ring-2' && 
                    button.classList[i] !== 'ring-offset-2') {
                    button.classList.remove(button.classList[i]);
                    i--; // 调整索引，因为移除了一个元素
                }
            }
        });
        
        // 找到对应颜色的按钮并选中它
        const targetColorClass = 'bg-' + categoryColor;
        let found = false;
        
        // 获取有序的类别颜色数组
        const orderedColors = getOrderedCategoryColors();
        // 获取当前分类在所有分类中的索引
        const categoryIndex = Object.keys(getCategoryColors()).indexOf(categoryName);
        
        console.log(`分类"${categoryName}"的索引: ${categoryIndex}, 目标颜色类: ${targetColorClass}`);
        
        // 方法1：通过索引查找对应的颜色按钮
        if (categoryIndex >= 0 && categoryIndex < colorButtons.length) {
            const button = colorButtons[categoryIndex];
            
            // 确保按钮有正确的背景色
            let hasCorrectBgColor = false;
            for (let i = 0; i < button.classList.length; i++) {
                if (button.classList[i] === targetColorClass) {
                    hasCorrectBgColor = true;
                    break;
                }
            }
            
            // 如果没有正确的背景色，添加它
            if (!hasCorrectBgColor) {
                // 清除所有现有的背景色类
                for (let i = 0; i < button.classList.length; i++) {
                    if (button.classList[i].startsWith('bg-')) {
                        button.classList.remove(button.classList[i]);
                        i--; // 调整索引，因为移除了一个元素
                    }
                }
                button.classList.add(targetColorClass);
                
                // 更新data-color属性
                button.setAttribute('data-color', categoryColor);
            }
            
            // 添加选中状态
            button.classList.add('ring-2', 'ring-offset-2');
            button.classList.add('ring-' + categoryColor);
            console.log(`已选中颜色按钮[${categoryIndex}]: ${targetColorClass}`);
            found = true;
        }
        
        // 方法2：如果方法1失败，通过data-color属性查找
        if (!found) {
            colorButtons.forEach((button, index) => {
                const buttonColor = button.getAttribute('data-color');
                if (buttonColor === categoryColor) {
                    // 为找到的颜色按钮添加选中状态
                    button.classList.add('ring-2', 'ring-offset-2');
                    button.classList.add('ring-' + categoryColor);
                    found = true;
                    console.log(`通过data-color属性找到并选中颜色按钮[${index}]: ${buttonColor}`);
                }
            });
        }
        
        // 方法3：如果方法1和方法2都失败，通过背景色类查找
        if (!found) {
            colorButtons.forEach((button, index) => {
                let hasTargetColor = false;
                for (let i = 0; i < button.classList.length; i++) {
                    if (button.classList[i] === targetColorClass) {
                        hasTargetColor = true;
                        break;
                    }
                }
                
                if (hasTargetColor) {
                    // 为找到的颜色按钮添加选中状态
                    button.classList.add('ring-2', 'ring-offset-2');
                    const ringClass = 'ring-' + categoryColor;
                    button.classList.add(ringClass);
                    found = true;
                    console.log(`通过背景色类找到并选中颜色按钮[${index}]: ${targetColorClass}`);
                    
                    // 更新data-color属性
                    if (!button.hasAttribute('data-color')) {
                        button.setAttribute('data-color', categoryColor);
                    }
                }
            });
        }
        
        if (!found) {
            console.warn(`未找到对应颜色按钮: ${targetColorClass}，尝试重新初始化颜色按钮`);
            // 如果没有找到对应的颜色按钮，重新初始化所有颜色按钮
            initColorSelection();
            
            // 再次尝试选中对应的颜色按钮
            if (categoryIndex >= 0 && categoryIndex < colorButtons.length) {
                const button = colorButtons[categoryIndex];
                button.classList.add('ring-2', 'ring-offset-2');
                button.classList.add('ring-' + categoryColor);
                console.log(`重新初始化后选中颜色按钮[${categoryIndex}]: ${targetColorClass}`);
                found = true;
            }
        }
        
        return found;
    }
    
    // 初始化颜色选择功能
    function initColorSelection() {
        const colorButtons = document.querySelectorAll('#color-container .rounded-full');
        console.log(`找到${colorButtons.length}个颜色选项`);
        
        // 使用category-colors.js中定义的永久映射颜色，确保按固定顺序排列
        const categoryColors = getOrderedCategoryColors();
        console.log('获取到有序类别颜色映射:', categoryColors);
        
        // 重置所有颜色按钮的类
        colorButtons.forEach((button, index) => {
            // 添加唯一ID
            button.id = `color-button-${index}`;
            
            // 清除所有现有的背景色类
            for (let i = 0; i < button.classList.length; i++) {
                if (button.classList[i].startsWith('bg-')) {
                    button.classList.remove(button.classList[i]);
                    i--; // 调整索引，因为移除了一个元素
                }
            }
            
            // 保留基本样式类
            if (!button.classList.contains('w-8')) button.classList.add('w-8');
            if (!button.classList.contains('h-8')) button.classList.add('h-8');
            if (!button.classList.contains('rounded-full')) button.classList.add('rounded-full');
            
            // 添加对应的颜色类
            if (index < categoryColors.length) {
                const colorClass = 'bg-' + categoryColors[index];
                button.classList.add(colorClass);
                
                // 添加data-color属性
                button.setAttribute('data-color', categoryColors[index]);
                
                console.log(`设置颜色按钮[${index}]的背景色为: ${colorClass}，data-color: ${categoryColors[index]}`);
            }
        });
        
        // 确保所有颜色按钮都有正确的背景色
        setTimeout(() => {
            colorButtons.forEach((button, index) => {
                let hasBgColor = false;
                for (let i = 0; i < button.classList.length; i++) {
                    if (button.classList[i].startsWith('bg-') && 
                        button.classList[i] !== 'bg-white' && 
                        button.classList[i] !== 'bg-gray-100') {
                        hasBgColor = true;
                        break;
                    }
                }
                
                if (!hasBgColor && index < categoryColors.length) {
                    const colorClass = 'bg-' + categoryColors[index];
                    button.classList.add(colorClass);
                    button.setAttribute('data-color', categoryColors[index]);
                    console.log(`修复颜色按钮[${index}]的背景色为: ${colorClass}`);
                }
            });
        }, 100);
        
        // 获取当前选中的分类
        const activeCategory = document.querySelector('.category-chip.active');
        if (activeCategory) {
            const categoryName = activeCategory.textContent.trim();
            console.log(`页面加载时默认选中的分类: ${categoryName}`);
            // 立即更新颜色选择器状态
            updateSelectedColorByCategory(categoryName);
        } else {
            // 如果没有选中的分类，默认选中第一个分类
            const firstCategory = document.querySelector('.category-chip');
            if (firstCategory) {
                const categoryName = firstCategory.textContent.trim();
                console.log(`没有默认选中的分类，选择第一个分类: ${categoryName}`);
                // 将第一个分类设为选中状态
                firstCategory.classList.add('active');
                firstCategory.classList.remove('bg-white', 'border', 'border-gray-200', 'text-gray-700');
                firstCategory.classList.add('bg-indigo-600', 'text-white');
                // 更新颜色选择器状态
                updateSelectedColorByCategory(categoryName);
            } else {
                // 默认选中第一个颜色
                if (colorButtons.length > 0) {
                    const firstButton = colorButtons[0];
                    firstButton.classList.add('ring-2', 'ring-offset-2');
                    
                    // 添加对应的ring-{color}类
                    const colorClass = Array.from(firstButton.classList).find(cls => cls.startsWith('bg-'));
                    if (colorClass) {
                        const ringClass = 'ring-' + colorClass.substring(3); // 将bg-xxx转换为ring-xxx
                        firstButton.classList.add(ringClass);
                    }
                }
            }
        }
    }
    
    // 页面加载完成后初始化语言功能和导航功能
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM加载完成，初始化功能');
        if (typeof initLanguage === 'function') {
            initLanguage();
        }
        
        // 检查navigation.js是否已加载
        console.log('检查导航脚本是否已加载');
        const scripts = document.querySelectorAll('script');
        let navigationLoaded = false;
        
        scripts.forEach(script => {
            if (script.src.includes('navigation.js')) {
                navigationLoaded = true;
                console.log('navigation.js已加载');
            }
        });
        
        if (!navigationLoaded) {
            console.error('navigation.js未加载，可能导致导航功能失效');
        }
        
        // 检查底部导航按钮
        const bottomNavButtons = document.querySelectorAll('.glass-effect.rounded-xl.p-3.mt-4 button');
        console.log(`找到${bottomNavButtons.length}个底部导航按钮`);
        
        // 为底部导航按钮添加额外的点击事件监听器（作为备份）
        bottomNavButtons.forEach((button, index) => {
            console.log(`为底部导航按钮[${index}]添加备份点击事件`);
            button.addEventListener('click', function(event) {
                const imgElement = this.querySelector('img');
                if (imgElement) {
                    const imgAlt = imgElement.alt;
                    console.log(`底部导航按钮[${index}]被点击，alt属性: "${imgAlt}"`);
                    
                    if (imgAlt === '首页' || imgAlt.includes('home')) {
                        console.log('首页按钮被点击，跳转到index.html');
                        window.location.href = 'index.html';
                    }
                }
            });
        });
        
        // 确保category-colors.js已加载
        if (typeof getCategoryColors === 'function') {
            console.log('category-colors.js已加载，初始化类别颜色');
            // 初始化类别颜色映射
            if (typeof initCategoryColors === 'function') {
                initCategoryColors();
            }
        } else {
            console.error('getCategoryColors函数未定义，请检查category-colors.js是否正确加载');
            // 尝试重新加载category-colors.js
            const script = document.createElement('script');
            script.src = 'category-colors.js';
            script.onload = function() {
                console.log('已重新加载category-colors.js');
                if (typeof initCategoryColors === 'function') {
                    initCategoryColors();
                }
                // 初始化分类和颜色选择功能
                initCategorySelection();
                initColorSelection();
            };
            document.head.appendChild(script);
        }
        
        // 初始化分类选择功能
        initCategorySelection();
        
        // 初始化颜色选择功能
        console.log('开始初始化颜色选择功能');
        initColorSelection();
        
        // 初始化保存按钮功能
        initSaveButton();
    });
    
    // 确保所有脚本加载完成
    window.addEventListener('load', function() {
        console.log('页面完全加载完成，确保所有功能初始化');
        if (typeof initLanguage === 'function') {
            initLanguage();
        } else {
            console.error('initLanguage函数未定义，请检查language-switcher.js是否正确加载');
        }
        
        // 再次检查颜色选择器是否正确初始化
        const colorButtons = document.querySelectorAll('#color-container .rounded-full');
        let allColorsCorrect = true;
        
        colorButtons.forEach((button, index) => {
            let hasBgColor = false;
            for (let i = 0; i < button.classList.length; i++) {
                if (button.classList[i].startsWith('bg-') && 
                    button.classList[i] !== 'bg-white' && 
                    button.classList[i] !== 'bg-gray-100') {
                    hasBgColor = true;
                    break;
                }
            }
            
            if (!hasBgColor) {
                allColorsCorrect = false;
                console.warn(`颜色按钮[${index}]没有正确的背景色类`);
            }
        });
        
        if (!allColorsCorrect) {
            console.log('检测到颜色按钮未正确初始化，重新初始化颜色选择功能');
            initColorSelection();
        }
        
        // 确保保存按钮功能已初始化
        if (typeof initSaveButton === 'function') {
            initSaveButton();
        }
    });
    
    // 初始化保存按钮功能
    function initSaveButton() {
        const saveButton = document.querySelector('.glass-effect.rounded-xl.p-4.flex.justify-between button.bg-indigo-600');
        if (saveButton) {
            console.log('找到保存按钮，添加点击事件');
            saveButton.addEventListener('click', handleSaveCountdown);
        } else {
            console.error('未找到保存按钮');
            // 尝试使用更宽松的选择器
            const altSaveButton = document.querySelector('button.bg-indigo-600');
            if (altSaveButton) {
                console.log('使用备用选择器找到保存按钮，添加点击事件');
                altSaveButton.addEventListener('click', handleSaveCountdown);
            }
        }
    }
    
    // 处理保存倒数日
    function handleSaveCountdown() {
        console.log('保存按钮被点击');
        
        // 收集表单数据
        const title = document.getElementById('title').value.trim();
        const dateInput = document.querySelector('input[type="date"]').value;
        const notes = document.getElementById('notes').value.trim();
        
        // 获取选中的分类
        let category = '其他';
        const activeCategory = document.querySelector('.category-chip.active');
        if (activeCategory) {
            category = activeCategory.textContent.trim();
        }
        
        // 根据分类获取对应的固定颜色
        let color = getCategoryColor(category);
        console.log(`根据分类"${category}"获取到固定颜色: ${color}`);
        
        // 获取提醒设置
        const reminderEnabled = document.querySelector('input[type="checkbox"]').checked;
        
        // 创建倒数日对象 - 不再设置color属性，让首页根据category动态获取颜色
        const countdown = {
            title: title,
            date: dateInput,
            category: category,
            notes: notes,
            reminder: reminderEnabled
        };
        
        console.log('准备保存的倒数日数据:', countdown);
        
        // 验证数据
        const validation = validateCountdown(countdown);
        
        if (!validation.isValid) {
            // 显示错误信息
            showValidationErrors(validation.errors);
            return;
        }
        
        try {
            // 检查countdown-storage.js是否已加载
            if (typeof addCountdown !== 'function') {
                console.error('addCountdown函数未定义，请检查countdown-storage.js是否正确加载');
                showErrorMessage('保存失败，系统错误');
                return;
            }
            
            // 保存倒数日
            const savedCountdown = addCountdown(countdown);
            console.log('倒数日保存成功:', savedCountdown);
            
            // 显示成功提示
            showSuccessMessage('倒数日添加成功！');
            
            // 延迟后返回首页
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1500);
        } catch (error) {
            console.error('保存倒数日时出错:', error);
            showErrorMessage('保存失败，请重试');
        }
    }
    
    // 显示验证错误
    function showValidationErrors(errors) {
        // 清除之前的错误提示
        clearValidationErrors();
        
        // 显示新的错误提示
        for (const field in errors) {
            const inputElement = document.getElementById(field);
            if (inputElement) {
                inputElement.classList.add('border-red-500');
                
                // 创建错误提示元素
                const errorElement = document.createElement('p');
                errorElement.className = 'text-red-500 text-xs mt-1 validation-error';
                errorElement.textContent = errors[field];
                
                // 插入到输入框后面
                inputElement.parentNode.appendChild(errorElement);
            } else if (field === 'date') {
                // 日期字段特殊处理
                const dateInput = document.querySelector('input[type="date"]');
                if (dateInput) {
                    dateInput.classList.add('border-red-500');
                    
                    const errorElement = document.createElement('p');
                    errorElement.className = 'text-red-500 text-xs mt-1 validation-error';
                    errorElement.textContent = errors[field];
                    
                    dateInput.parentNode.appendChild(errorElement);
                }
            } else if (field === 'category') {
                // 分类字段特殊处理
                const categoryContainer = document.querySelector('.category-chip').parentNode;
                
                const errorElement = document.createElement('p');
                errorElement.className = 'text-red-500 text-xs mt-1 validation-error';
                errorElement.textContent = errors[field];
                
                categoryContainer.appendChild(errorElement);
            }
        }
    }
    
    // 清除验证错误
    function clearValidationErrors() {
        // 移除所有错误提示
        const errorElements = document.querySelectorAll('.validation-error');
        errorElements.forEach(element => element.remove());
        
        // 移除输入框的错误样式
        document.getElementById('title')?.classList.remove('border-red-500');
        document.querySelector('input[type="date"]')?.classList.remove('border-red-500');
    }
    
    // 验证倒数日数据
    function validateCountdown(countdown) {
        const errors = {};
        let isValid = true;
        
        // 验证标题
        if (!countdown.title) {
            errors.title = '请输入标题';
            isValid = false;
        }
        
        // 验证日期
        if (!countdown.date) {
            errors.date = '请选择日期';
            isValid = false;
        }
        
        return {
            isValid: isValid,
            errors: errors
        };
    }
    
    // 显示成功消息
    function showSuccessMessage(message) {
        showMessage(message, 'success');
    }
    
    // 显示错误消息
    function showErrorMessage(message) {
        showMessage(message, 'error');
    }
    
    // 显示消息
    function showMessage(message, type) {
        // 创建消息元素
        const messageElement = document.createElement('div');
        messageElement.className = `fixed top-4 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-lg z-50 ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white font-medium shadow-lg`;
        messageElement.textContent = message;
        
        // 添加到页面
        document.body.appendChild(messageElement);
        
        // 设置自动消失
        setTimeout(() => {
            messageElement.classList.add('opacity-0', 'transition-opacity', 'duration-500');
            setTimeout(() => {
                document.body.removeChild(messageElement);
            }, 500);
        }, 3000);
    }
</script>
</body>
</html>